<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Details - Growth Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-primary">Growth Lab</a>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="index.html" class="text-dark hover:text-primary transition">Home</a>
                    <a href="courses.html" class="text-dark hover:text-primary transition">Courses</a>
                    <a href="contact.html" class="text-dark hover:text-primary transition">Contact</a>
                </div>
                <div class="hidden md:flex items-center space-x-4" id="auth-buttons">
                    <a href="login.html" class="text-dark hover:text-primary transition">Login</a>
                    <a href="register.html" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">Register</a>
                </div>
                <div class="hidden items-center space-x-4" id="user-menu">
                    <div class="relative" id="dropdown-container">
                        <button id="dropdown-button" class="flex items-center space-x-1">
                            <span id="username">User</span>
                            <i class="fas fa-chevron-down text-sm"></i>
                        </button>
                        <div id="dropdown-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden">
                            <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                            <a href="instructor-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="instructor-link">Instructor Dashboard</a>
                            <a href="#" id="logout-button" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
                        </div>
                    </div>
                </div>
                <button class="md:hidden" id="mobile-menu-button">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="flex flex-col space-y-3 py-3">
                    <a href="index.html" class="text-dark hover:text-primary transition">Home</a>
                    <a href="courses.html" class="text-dark hover:text-primary transition">Courses</a>
                    <a href="contact.html" class="text-dark hover:text-primary transition">Contact</a>
                    <div id="mobile-auth-buttons">
                        <a href="login.html" class="block text-dark hover:text-primary transition mb-2">Login</a>
                        <a href="register.html" class="block bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition w-full text-center">Register</a>
                    </div>
                    <div id="mobile-user-menu" class="hidden">
                        <a href="profile.html" class="block text-dark hover:text-primary transition">Profile</a>
                        <a href="instructor-dashboard.html" class="block text-dark hover:text-primary transition" id="mobile-instructor-link">Instructor Dashboard</a>
                        <a href="#" id="mobile-logout-button" class="block text-dark hover:text-primary transition">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Course Details -->
    <div class="container mx-auto px-4 py-12">
        <div class="animate-pulse" id="course-loading">
            <div class="bg-gray-300 h-8 w-3/4 mb-4 rounded"></div>
            <div class="bg-gray-300 h-4 w-1/2 mb-8 rounded"></div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-gray-300 h-96 w-full mb-8 rounded"></div>
                    <div class="bg-gray-300 h-6 w-full mb-4 rounded"></div>
                    <div class="bg-gray-300 h-6 w-full mb-4 rounded"></div>
                    <div class="bg-gray-300 h-6 w-3/4 mb-8 rounded"></div>
                    <div class="bg-gray-300 h-6 w-1/2 mb-4 rounded"></div>
                    <div class="bg-gray-300 h-6 w-full mb-4 rounded"></div>
                    <div class="bg-gray-300 h-6 w-full mb-4 rounded"></div>
                    <div class="bg-gray-300 h-6 w-2/3 mb-8 rounded"></div>
                </div>
                <div>
                    <div class="bg-gray-300 h-64 w-full mb-8 rounded"></div>
                    <div class="bg-gray-300 h-12 w-full mb-4 rounded"></div>
                </div>
            </div>
        </div>

        <div id="course-details" class="hidden">
            <div class="mb-8">
                <a href="courses.html" class="text-primary hover:underline mb-4 inline-block">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Courses
                </a>
                <h1 id="course-title" class="text-3xl md:text-4xl font-bold mb-2"></h1>
                <div class="flex items-center text-gray-600 mb-6">
                    <span class="mr-4">
                        <i class="fas fa-user mr-1"></i> 
                        <span id="course-instructor"></span>
                    </span>
                    <span>
                        <i class="fas fa-clock mr-1"></i>
                        <span id="course-duration"></span>
                    </span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="mb-8">
                        <img id="course-image" src="/placeholder.svg" alt="" class="w-full h-auto rounded-lg shadow-md mb-6">
                        <h2 class="text-2xl font-semibold mb-4">Course Description</h2>
                        <p id="course-description" class="text-gray-700 mb-6"></p>
                    </div>

                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold mb-4">What You'll Learn</h2>
                        <div id="course-features" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                    </div>

                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold mb-4">Who This Course is For</h2>
                        <div id="course-target" class="text-gray-700"></div>
                    </div>

                    <!-- Reviews Section -->
                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold mb-4">Student Reviews</h2>
                        <div id="reviews-container">
                            <div id="reviews-list" class="space-y-6 mb-8"></div>
                            
                            <div id="review-form-container" class="bg-white p-6 rounded-lg shadow-md hidden">
                                <h3 class="text-xl font-semibold mb-4">Leave a Review</h3>
                                <form id="review-form">
                                    <div class="mb-4">
                                        <label for="review-body" class="block text-gray-700 mb-2">Your Review</label>
                                        <textarea id="review-body" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required></textarea>
                                    </div>
                                    <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-600 transition">Submit Review</button>
                                </form>
                            </div>
                            
                            <div id="login-to-review" class="bg-gray-100 p-6 rounded-lg text-center hidden">
                                <p class="text-gray-700 mb-4">Please log in to leave a review</p>
                                <a href="login.html" class="inline-block bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-600 transition">Login</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="bg-white rounded-lg shadow-md p-6 sticky top-6">
                        <div class="mb-6">
                            <div class="text-3xl font-bold text-primary mb-2" id="course-price"></div>
                        </div>
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-3">This course includes:</h3>
                            <ul class="space-y-2">
                                <li class="flex items-center">
                                    <i class="fas fa-video text-primary mr-2"></i>
                                    <span>Full lifetime access</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-mobile-alt text-primary mr-2"></i>
                                    <span>Access on mobile and desktop</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-certificate text-primary mr-2"></i>
                                    <span>Certificate of completion</span>
                                </li>
                            </ul>
                        </div>
                        <button id="enroll-button" class="w-full bg-primary text-white py-3 rounded-md font-semibold hover:bg-blue-600 transition">Enroll Now</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">Growth Lab</h3>
                    <p class="text-gray-400 mb-4">Empowering individuals to master new skills and advance their careers through quality education.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-white transition">Home</a></li>
                        <li><a href="courses.html" class="text-gray-400 hover:text-white transition">Courses</a></li>
                        <li><a href="about.html" class="text-gray-400 hover:text-white transition">About Us</a></li>
                        <li><a href="contact.html" class="text-gray-400 hover:text-white transition">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Course Categories</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Web Development</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Data Science</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Mobile Development</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">UX/UI Design</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Contact Us</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt mt-1 mr-2"></i>
                            <span>123 Education St, Learning City, 10001</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone-alt mr-2"></i>
                            <span>+1 (555) 123-4567</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-envelope mr-2"></i>
                            <span>info@growthlab.com</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2023 Growth Lab. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="auth.js"></script>
    <script src="api.js"></script>
    <script>
        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Dropdown menu toggle
        const dropdownButton = document.getElementById('dropdown-button');
        const dropdownMenu = document.getElementById('dropdown-menu');

        if (dropdownButton) {
            dropdownButton.addEventListener('click', () => {
                dropdownMenu.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (event) => {
                const container = document.getElementById('dropdown-container');
                if (container && !container.contains(event.target)) {
                    dropdownMenu.classList.add('hidden');
                }
            });
        }

        // Get course ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id');
        let currentCourse = null;
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Check auth status
                currentUser = await checkAuthStatus();
                
                // Load course details
                if (courseId) {
                    currentCourse = await fetchCourseById(courseId);
                    displayCourseDetails(currentCourse);
                    
                    // Load reviews
                    const reviews = await fetchReviewsByCourse(courseId);
                    displayReviews(reviews);
                    
                    // Setup review form
                    setupReviewForm();
                } else {
                    window.location.href = 'courses.html';
                }
            } catch (error) {
                console.error('Error loading course details:', error);
            }
        });

        function displayCourseDetails(course) {
            document.title = `${course.Title} - Growth Lab`;
            
            // Hide loading, show details
            document.getElementById('course-loading').classList.add('hidden');
            document.getElementById('course-details').classList.remove('hidden');
            
            // Set course details
            document.getElementById('course-title').textContent = course.Title;
            document.getElementById('course-instructor').textContent = course.Instructor.username;
            document.getElementById('course-duration').textContent = course.Duration || 'Self-paced';
            document.getElementById('course-description').textContent = course.Description;
            document.getElementById('course-price').textContent = `$${course.Price}`;
            
            // Set course image
            const courseImage = document.getElementById('course-image');
            courseImage.src = `https://source.unsplash.com/random/800x600/?course,${course.Title.replace(' ', ',')}`;
            courseImage.alt = course.Title;
            
            // Set course features
            const featuresContainer = document.getElementById('course-features');
            const features = course.Features.split('\n');
            
            featuresContainer.innerHTML = '';
            features.forEach(feature => {
                if (feature.trim()) {
                    featuresContainer.innerHTML += `
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                            <span>${feature.trim()}</span>
                        </div>
                    `;
                }
            });
            
            // Set course target audience
            const targetContainer = document.getElementById('course-target');
            const targets = course.Target.split('\n');
            
            targetContainer.innerHTML = '';
            targets.forEach(target => {
                if (target.trim()) {
                    targetContainer.innerHTML += `<p class="mb-2">${target.trim()}</p>`;
                }
            });
            
            // Setup enroll button
            const enrollButton = document.getElementById('enroll-button');
            enrollButton.addEventListener('click', () => {
                if (!currentUser) {
                    window.location.href = `login.html?redirect=course-detail.html?id=${courseId}`;
                } else {
                    alert('Thank you for enrolling in this course!');
                    // In a real application, you would make an API call to enroll the user
                }
            });
        }
        
        async function fetchReviewsByCourse(courseId) {
            try {
                const response = await fetch(`${API_URL}/main/reviews/`);
                if (!response.ok) {
                    throw new Error('Failed to fetch reviews');
                }
                const reviews = await response.json();
                return reviews.filter(review => review.course == courseId);
            } catch (error) {
                console.error('Error fetching reviews:', error);
                return [];
            }
        }
        
        function displayReviews(reviews) {
            const reviewsList = document.getElementById('reviews-list');
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = '<p class="text-gray-600">No reviews yet. Be the first to review this course!</p>';
                return;
            }
            
            reviewsList.innerHTML = '';
            reviews.forEach(review => {
                const date = new Date(review.created).toLocaleDateString();
                reviewsList.innerHTML += `
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="font-semibold">${review.user.username || 'Anonymous'}</h4>
                                <p class="text-gray-500 text-sm">${date}</p>
                            </div>
                        </div>
                        <p class="text-gray-700">${review.body}</p>
                    </div>
                `;
            });
        }
        
        function setupReviewForm() {
            const reviewFormContainer = document.getElementById('review-form-container');
            const loginToReview = document.getElementById('login-to-review');
            
            if (currentUser) {
                reviewFormContainer.classList.remove('hidden');
                loginToReview.classList.add('hidden');
                
                const reviewForm = document.getElementById('review-form');
                reviewForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const reviewBody = document.getElementById('review-body').value;
                    
                    try {
                        await submitReview(courseId, reviewBody);
                        const reviews = await fetchReviewsByCourse(courseId);
                        displayReviews(reviews);
                        document.getElementById('review-body').value = '';
                    } catch (error) {
                        console.error('Error submitting review:', error);
                        alert('Failed to submit review. Please try again.');
                    }
                });
            } else {
                reviewFormContainer.classList.add('hidden');
                loginToReview.classList.remove('hidden');
            }
        }
        
        async function submitReview(courseId, body) {
            const token = localStorage.getItem('token');
            if (!token) {
                throw new Error('Not authenticated');
            }
            
            const response = await fetch(`${API_URL}/main/reviews/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    course: courseId,
                    body: body
                })
            });
            
            if (!response.ok) {
                throw new Error('Failed to submit review');
            }
            
            return await response.json();
        }
    </script>
</body>
</html>